function $(){var c=new Array();for(var b=0;b<arguments.length;b++){var a=arguments[b];if(typeof a=="string"){a=document.getElementById(a)}if(arguments.length==1){return a}c.push(a)}return c}function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a}Array.prototype.removeAt=function(a){if(isNaN(a)||a>this.length){return false}this.splice(a,1)};Element.prototype.createChild=function(a,c,d){var b=document.createElement(a);this.appendChild(b);if(c){for(key in c){b.setAttribute(key,c[key])}}if(d){b.innerHTML=d}return b};Element.prototype.hasClassName=function(b){return new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(this.className)};Element.prototype.addClassName=function(b){if(!this.hasClassName(b)){this.className=[this.className,b].join(" ")}};Element.prototype.removeClassName=function(c){if(this.hasClassName(c)){var d=this.className;this.className=d.replace(new RegExp("(?:^|\\s+)"+c+"(?:\\s+|$)","g")," ")}};var canvasPrototype=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;canvasPrototype.antiFuzzyLine=function(b,d,a,c){if(this.lineWidth%2==1){if(this.lineWidth>1){console.log(this.lineWidth)}b-=0.5;d-=0.5;a-=0.5;c-=0.5}this.moveTo(b,d);this.lineTo(a,c)};canvasPrototype.fillTextEx=function(e,b,g,c,f){this.save();var a=b;if(c!="left"){var d=this.measureText(e).width;if(c=="center"){a-=d/2}else{if(c=="right"){a-=d}}}this.textBaseline=f;this.fillText(e,a,g);this.restore()};var CanvasSize={Fixed:0,Dynamic:1,Fullscreen:2};var Config={General:{},Game:{padding:4,backgroundColor:"#DEEDF7",keyboardTimerDelay:200,canvasSize:CanvasSize.Fixed,gridSize:10,width:500,height:500},Maze:{rows:32,cols:32,wallColor:"RGB(0, 0, 0)",highlightedWallColor:"#ff0000",highlightedCellColor:"RGBA(171,174,180,0.5)",showStep:false,stepDelay:20},Path:{pathColor:"RGBA(219, 69, 32, 1)",entranceColor:"#436EB3",exitColor:"#03A957",stepColor:"#436EB3",fMinColor:"#ff3300",openAreaColor:"RGBA(255,0,0,0.3)",closeAreaColor:"RGBA(171,174,180,0.5)",showStep:false,stepDelay:40}};function Game(){this.maze=new Maze(Config.Maze.rows,Config.Maze.cols);this.path=new Path();this.width=0;this.height=0;this.cellSize=0;this.canvas=null;this.context=null;this.arrowKeyStatus=0;this.keyboardTimer=null;this.init()}Game.prototype={init:function(){var b=this;this.width=document.documentElement.clientWidth;this.height=document.documentElement.clientHeight;this.render();function a(){b.redraw()}this.maze.onUpdateUI=a;this.path.onUpdateUI=a;this.maze.onInitComplete=function(){b.path.init(b.maze)};this.maze.init();this.path.onPathComplete=function(){$("step-counter-auto").innerHTML=this.getPathLength()}},render:function(){var b=this;var a=document.body;var d=a.createChild("div",{id:"game-wrapper",style:"padding: "+Config.Game.padding+"px"});this.canvas=d.createChild("canvas",{id:"game-canvas",width:0,height:0});if(typeof G_vmlCanvasManager!="undefined"){this.canvas=G_vmlCanvasManager.initElement(this.canvas)}this.context=this.canvas.getContext("2d");this.resizeCanvas();function c(){var f=document.documentElement.clientWidth;var e=document.documentElement.clientHeight;if(f!=b.width||e!=b.height){b.width=f;b.height=e;b.resizeCanvas()}}setInterval(c,200);this.renderToolbar(a);this.handleKeyEvent=function(f){switch(f.type){case"keydown":b.keyDown(f);break;case"keyup":b.keyUp(f);break}};document.addEventListener("keydown",this.handleKeyEvent,false);document.addEventListener("keyup",this.handleKeyEvent,false)},renderToolbar:function(b){var c=this;var d=b.createChild("div",{style:"padding:"+Config.Game.padding+"px;","class":"toolbar"});this.newToolElement(this.newToolElement(d,"|",false,null),"How to play:",true,null);this.newToolElement(d,"-",false,null);this.newToolElement(this.newToolElement(d,"|",false,null),"1) Reset Maze",false,function(g,f){c.resetMaze()});this.newToolElement(this.newToolElement(d,"|",false,null),"&nbsp;&nbsp;&nbsp;&nbsp;(Initialize a maze)",false,null);var a=this.newToolElement(d,"|",false,null);this.newToolElement(a,"&nbsp;&nbsp;&nbsp;&nbsp;Show Step by Step - ",false,null);this.newToolElement(a,Config.Maze.showStep?"ON":"OFF",false,function(g,f){Config.Maze.showStep=!Config.Maze.showStep;f.innerHTML=Config.Maze.showStep?"ON":"OFF"});var a=this.newToolElement(d,"|",false,null);this.newToolElement(a,"&nbsp;&nbsp;&nbsp;&nbsp;Maze Size - ",false,null);a.createChild("span",{id:"maze-size","class":"highlighted"},"M");this.newToolElement(a," [",false,null);this.newToolElement(a,"XS",false,function(g,f){c.resizeMaze("XS")});this.newToolElement(a," ",false,null);this.newToolElement(a,"S",false,function(g,f){c.resizeMaze("S")});this.newToolElement(a," ",false,null);this.newToolElement(a,"M",false,function(g,f){c.resizeMaze("M")});this.newToolElement(a," ",false,null);this.newToolElement(a,"L",false,function(g,f){c.resizeMaze("L")});this.newToolElement(a," ",false,null);this.newToolElement(a,"XL",false,function(g,f){c.resizeMaze("XL")});this.newToolElement(a,"] ",false,null);this.newToolElement(this.newToolElement(d,"|",false,null),"2) Entrance & Exit",false,function(g,f){c.resetEntranceAndExit()});a=this.newToolElement(d,"|");this.newToolElement(this.newToolElement(d,"|",false,null),"&nbsp;&nbsp;&nbsp;&nbsp;(Get randomized start and end points)",false,null);this.newToolElement(this.newToolElement(d,"|",false,null),"3) Move",false,null);this.newToolElement(this.newToolElement(d,"|",false,null),"&nbsp;&nbsp;&nbsp;&nbsp;(Use keyboard arrows to control)",false,null);this.newToolElement(this.newToolElement(d,"|",false,null),"4) Show Path",false,function(g,f){c.getPath()});this.newToolElement(this.newToolElement(d,"|",false,null),"&nbsp;&nbsp;&nbsp;&nbsp;(Let the computer find the path for you)",false,null);a=this.newToolElement(d,"|",false,null);this.newToolElement(a,"&nbsp;&nbsp;&nbsp;&nbsp;Show Step by Step - ",false,null);this.newToolElement(a,Config.Path.showStep?"ON":"OFF",false,function(g,f){Config.Path.showStep=!Config.Path.showStep;f.innerHTML=Config.Path.showStep?"ON":"OFF";c.redraw()});this.newToolElement(d,"-",false,null);a=this.newToolElement(d,"|",false,null);this.newToolElement(a,"Step Counter: ",false,null);a.createChild("span",{id:"step-counter-manual","class":"highlighted"},"0");a=this.newToolElement(d,"|",false,null);this.newToolElement(a,"Auto Path Length: ",false,null);a.createChild("span",{id:"step-counter-auto","class":"highlighted"},"-1");this.newToolElement(d,"-",false,null);a=this.newToolElement(d,"|",false,null);this.newToolElement(a,"Copyright (C) QLike.com",false,null)},newToolElement:function(d,e,a,c){var b=null;if(e=="|"){b=d.createChild("div",{"class":"toolbar-line"})}else{if(e=="-"){b=d.createChild("div",{"class":"toolbar-separator"})}else{if(c==null){b=d.createChild("span",{"class":"toolbar-text"},e)}else{b=d.createChild("span",{"class":"toolbar-linkbutton"},e);b.onclick=function(f){c(f,this)}}}}if(a){b.addClassName("highlighted")}return b},resizeMaze:function(a){switch(a){case"XS":this.maze.rows=16;this.maze.cols=16;break;case"S":this.maze.rows=24;this.maze.cols=24;break;case"M":this.maze.rows=32;this.maze.cols=32;break;case"L":this.maze.rows=48;this.maze.cols=48;break;case"XL":this.maze.rows=64;this.maze.cols=64;break}$("maze-size").innerHTML=a;this.resizeCanvas();this.resetMaze()},keyDown:function(d){var a=this;var c=event.keyCode;switch(c){case 37:this.arrowKeyStatus|=1;break;case 38:this.arrowKeyStatus|=1<<1;break;case 39:this.arrowKeyStatus|=1<<2;break;case 40:this.arrowKeyStatus|=1<<3;break}if(this.arrowKeyStatus>0&&this.keyboardTimer==null){b()}function b(){var e=0;var f=0;if((a.arrowKeyStatus&1)>0){f--}if((a.arrowKeyStatus&(1<<1))>0){e--}if((a.arrowKeyStatus&(1<<2))>0){f++}if((a.arrowKeyStatus&(1<<3))>0){e++}if(a.arrowKeyStatus>0){a.moveStep(e,f);a.keyboardTimer=setTimeout(b,Config.Game.keyboardTimerDelay)}else{a.keyboardTimer=null}}},keyUp:function(b){var a=event.keyCode;switch(a){case 37:this.arrowKeyStatus&=~1;break;case 38:this.arrowKeyStatus&=~(1<<1);break;case 39:this.arrowKeyStatus&=~(1<<2);break;case 40:this.arrowKeyStatus&=~(1<<3);break}if(this.arrowKeyStatus==0){if(this.keyboardTimer!=null){clearTimeout(this.keyboardTimer);this.keyboardTimer=null}}},resizeCanvas:function(){var b=this.width-Config.Game.padding*2;var d=this.height-Config.Game.padding*2;var c=b/this.maze.rows;var a=d/this.maze.cols;if(c>a){this.cellSize=Math.floor(a)}else{this.cellSize=Math.floor(c)}this.canvas.width=this.maze.rows*this.cellSize;this.canvas.height=this.maze.cols*this.cellSize;this.redraw()},redraw:function(){this.context.save();this.context.fillStyle=Config.Game.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height);this.context.restore();this.maze.redraw(this.context,this.cellSize);this.path.redraw(this.context,this.cellSize)},resetMaze:function(){this.path.init();this.maze.init();$("step-counter-manual").innerHTML=this.path.stepCounter;$("step-counter-auto").innerHTML=this.path.getPathLength()},resetEntranceAndExit:function(){this.path.randomEntranceAndExit();$("step-counter-manual").innerHTML=this.path.stepCounter;$("step-counter-auto").innerHTML=this.path.getPathLength()},getPath:function(){this.path.getPath()},moveStep:function(a,b){this.path.moveStep(a,b);$("step-counter-manual").innerHTML=this.path.stepCounter}};var game=null;addEventListener("load",function(){game=new Game()});function Maze(a,b){this.rows=a;this.cols=b;this.cells=[];this.walls=[];this.tempWalls=[];this.onUpdateUI=null;this.onInitComplete=null}Maze.prototype={updateUI:function(){if(typeof this.onUpdateUI=="function"){this.onUpdateUI()}},initComplete:function(){if(typeof this.onInitComplete=="function"){this.onInitComplete()}},init:function(){this.cells=[];this.walls=[];for(var c=0;c<this.rows;c++){for(var b=0;b<this.cols;b++){var a=new Cell(c,b);this.cells.push(a)}}this.generateWalls();this.generateMaze()},generateWalls:function(){for(var b=0;b<this.rows*this.cols;b++){if(b/this.rows<this.cols-1){var d=this.cells[b];var c=this.cells[b+this.rows];var a=new Wall(d,c);this.walls.push(a);d.walls.push(a);c.walls.push(a)}if(b%this.rows<this.rows-1){var d=this.cells[b];var c=this.cells[b+1];var a=new Wall(d,c);this.walls.push(a);d.walls.push(a);c.walls.push(a)}}},generateMaze:function(){var b=this;this.tempWalls=[];this.fetchClosingWalls(this.tempWalls,this.cells[rand(0,this.cells.length)]);if(!Config.Maze.showStep){while(this.tempWalls.length>0){this.processRandomWall(false)}this.updateUI();this.initComplete()}else{function a(){if(b.tempWalls.length>0){b.processRandomWall(true);setTimeout(a,Config.Maze.stepDelay)}else{b.initComplete()}}a()}},processRandomWall:function(c){var b=rand(0,this.tempWalls.length-1);var a=this.tempWalls[b];var e=a.cellA;var d=a.cellB;if(e.connected&&d.connected){this.tempWalls.removeAt(b)}else{a.setOpen(true);if(c){this.updateUI()}if(e.connected){this.fetchClosingWalls(this.tempWalls,d)}else{if(d.connected){this.fetchClosingWalls(this.tempWalls,e)}}}},fetchClosingWalls:function(c,b){b.setConnected(true);for(var d=0;d<b.walls.length;d++){var a=b.walls[d];if(!a.isOpen){c.push(a)}}},redraw:function(e,g){function d(i,h,l,j){var k=j?l*0.1:0;i.rect(h.col*l+k,h.row*l+k,l-2*k,l-2*k)}e.save();e.lineWidth=1;e.beginPath();for(var c=0;c<this.walls.length;c++){if(this.walls[c].isOpen){continue}var b=this.walls[c];var a=b.cellB.col*g;var f=b.cellB.row*g;if(b.cellA.row==b.cellB.row){e.antiFuzzyLine(a,f,a,f+g)}else{e.antiFuzzyLine(a,f,a+g,f)}}e.antiFuzzyLine(0,1,this.cols*g,1);e.antiFuzzyLine(this.cols*g,0,this.cols*g,this.rows*g);e.antiFuzzyLine(this.cols*g,this.rows*g,0,this.rows*g);e.antiFuzzyLine(1,this.rows*g,1,0);e.strokeStyle=Config.Maze.wallColor;e.stroke();if(Config.Maze.showStep){e.beginPath();for(var c=0;c<this.tempWalls.length;c++){var b=this.tempWalls[c];var a=b.cellB.col*g;var f=b.cellB.row*g;if(b.cellA.row==b.cellB.row){e.antiFuzzyLine(a,f,a,f+g)}else{e.antiFuzzyLine(a,f,a+g,f)}}e.strokeStyle=Config.Maze.highlightedWallColor;e.stroke();e.beginPath();for(var c=0;c<this.tempWalls.length;c++){var b=this.tempWalls[c];d(e,b.cellA,g,false);d(e,b.cellB,g,false)}e.fillStyle=Config.Maze.highlightedCellColor;e.fill()}e.restore()}};function Wall(b,a){this.cellA=b;this.cellB=a;this.isOpen=false}Wall.prototype={setOpen:function(a){this.isOpen=a},getOtherCell:function(a){if(a.row==this.cellA.row&&a.col==this.cellA.col){return this.cellB}else{if(a.row==this.cellB.row&&a.col==this.cellB.col){return this.cellA}else{return null}}}};function Cell(b,a){this.row=b;this.col=a;this.connected=false;this.walls=[]}Cell.prototype={setConnected:function(a){this.connected=a}};function Path(){this.maze=null;this.openArea=[];this.closeArea={};this.cache={};this.entranceNode=null;this.exitNode=null;this.stepNode=null;this.fMinNode=null;this.path=[];this.onUpdateUI=null;this.onPathComplete=null;this.stepCounter=0}Path.prototype={updateUI:function(){if(typeof this.onUpdateUI=="function"){this.onUpdateUI()}},pathComplete:function(){if(this.pathFound()){this.path.push({row:this.exitNode.row,col:this.exitNode.col});var a=this.exitNode.prev;while(a!==this.entranceNode){this.path.push({row:a.row,col:a.col});a=a.prev}this.path.push({row:this.entranceNode.row,col:this.entranceNode.col})}this.updateUI();if(typeof this.onPathComplete=="function"){this.onPathComplete()}},init:function(h){this.cache={};this.entranceNode=null;this.exitNode=null;this.stepNode=null;this.fMinNode=null;this.openArea=[];this.closeArea={};this.path=[];this.stepCounter=0;if(h!=null){this.maze=h;var d=h.cells;for(var e=0;e<d.length;e++){var b=d[e];var f=new AStarNode(b.row,b.col);for(var c=0;c<b.walls.length;c++){var a=b.walls[c];if(a.isOpen){var g=a.getOtherCell(b);f.neighbors.push({row:g.row,col:g.col})}}this.cache[f.id]=f}this.randomEntranceAndExit()}else{this.updateUI()}},getPath:function(){var b=this;if(this.entranceNode==null||this.exitNode==null){return}this.path=[];this.openArea=[];this.closeArea={};this.neighboursIntoOpenArea(this.entranceNode);if(this.openArea.length==0){return}if(!Config.Path.showStep){while(!this.pathFound()){this.fMinNode=this.getOpenNodeWithMinF();if(!this.fMinNode){break}this.neighboursIntoOpenArea(this.fMinNode)}this.pathComplete()}else{function a(){if(Config.Path.showStep){if(!b.pathFound()){b.fMinNode=b.getOpenNodeWithMinF();if(b.fMinNode){b.neighboursIntoOpenArea(b.fMinNode);b.updateUI();setTimeout(a,Config.Path.stepDelay)}}else{b.pathComplete()}}}a()}},getNode:function(b,a){return this.cache["row_"+b+"_col_"+a]},getF:function(b,e){var a=(this.exitNode.col-e.col)*10;var f=(this.exitNode.row-e.row)*10;var c=Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(f,2)));var d=(b.col==e.col||b.row==e.row)?10:14;if(b.fObj){d=b.fObj.G+d}return{F:c+d,H:c,G:d}},inOpenArea:function(d){var b=this.openArea;for(var c=0,a=b.length;c<a;c++){if(b[c].id===d.id){return b[c]}}return null},neighboursIntoOpenArea:function(e){for(var c=0;c<e.neighbors.length;c++){var a=e.neighbors[c];var b=this.getNode(a.row,a.col);if(!this.closeArea[b.id]){var d=this.getF(e,b);tmpNode=this.inOpenArea(b);if(tmpNode){if(tmpNode.fObj.G<=d.G){continue}}b.fObj=d;b.prev=e;this.openArea.push(b)}}},getOpenNodeWithMinF:function(){if(this.openArea.length==0){return null}this.sortOpenArea();this.closeArea[this.openArea[0].id]=this.openArea[0];return this.openArea.shift()},sortOpenArea:function(){this.openArea.sort(function(b,a){return b.fObj.F-a.fObj.F})},redraw:function(b,a){if(this.entranceNode==null||this.exitNode==null||this.stepNode==null){return}function f(l,i,o,m){var n=m?o*0.1:0;l.moveTo(i.col*o+n,i.row*o+n);l.lineTo(i.col*o+o-n,i.row*o+o/2);l.lineTo(i.col*o+n,i.row*o+o-n)}function e(l,i,o,m){var n=m?o*0.1:0;l.rect(i.col*o+n,i.row*o+n,o-2*n,o-2*n)}function j(l,i,o,m){var n=m?o*0.1:0;l.arc(i.col*o+o/2,i.row*o+o/2,o/2-n,0,Math.PI*2,false)}b.save();if(Config.Path.showStep){b.beginPath();for(key in this.closeArea){e(b,this.closeArea[key],a,false)}b.fillStyle=Config.Path.closeAreaColor;b.fill();b.beginPath();for(var d=0;d<this.openArea.length;d++){e(b,this.openArea[d],a,false)}b.fillStyle=Config.Path.openAreaColor;b.fill()}if(this.path.length>0){b.beginPath();for(var d=0;d<this.path.length;d++){var k=this.path[d].row;var c=this.path[d].col;var h=c*a+a/2;var g=k*a+a/2;if(d==0){b.moveTo(h,g)}else{b.lineTo(h,g)}}b.strokeStyle=Config.Path.pathColor;b.lineWidth=a/4;b.lineJoin="round";b.stroke()}if(Config.Path.showStep&&this.fMinNode!=null){b.fillStyle=Config.Path.fMinColor;b.beginPath();j(b,this.fMinNode,a,true);b.fill()}b.fillStyle=Config.Path.entranceColor;b.beginPath();e(b,this.entranceNode,a,true);b.fill();b.fillStyle=Config.Path.exitColor;b.beginPath();f(b,this.exitNode,a,true);b.fill();b.fillStyle=Config.Path.stepColor;b.beginPath();j(b,this.stepNode,a,true);b.fill();if(this.stepNode.row==this.exitNode.row&&this.stepNode.col==this.exitNode.col){b.fillStyle="#FF3300";b.font="50px verdana";b.fillTextEx("Congratulations!",this.maze.rows*a/2,this.maze.cols*a/2,"center","middle")}b.restore()},pathFound:function(){return this.exitNode!=null&&this.closeArea[this.exitNode.id]},getPathLength:function(){return this.path.length-1},randomEntranceAndExit:function(){if(this.maze==null){return}this.setEntranceAndExit(rand(0,this.maze.rows-1),0,rand(0,this.maze.rows-1),this.maze.cols-1);this.updateUI()},setEntranceAndExit:function(c,d,a,b){this.entranceNode=this.getNode(c,d);this.exitNode=this.getNode(a,b);this.stepNode=this.getNode(c,d);this.fMinNode=null;this.openArea=[];this.closeArea={};this.path=[];this.stepCounter=0;this.updateUI()},moveStep:function(d,b){if(this.stepNode==null){return false}var c=this.stepNode.row+d;var e=this.stepNode.col+b;var a=this.getNode(c,e);if(a!=null&&this.stepNode.canGoTo(a)){this.stepNode=a;this.stepCounter++;this.updateUI();return true}else{return false}}};function AStarNode(b,a){this.row=b;this.col=a;this.id="row_"+b+"_col_"+a;this.prev=null;this.fObj=null;this.neighbors=[]}AStarNode.prototype={canGoTo:function(b){for(var a=0;a<this.neighbors.length;a++){if(this.neighbors[a].row==b.row&&this.neighbors[a].col==b.col){return true}}return false}};